## Redmine かんばん（運用強化版）SPA

---

## 1. 目的

本かんばんは「見た目の整理」ではなく、以下を日次運用で確実に実現する。

1. **Flow可視化**：どこに仕事が滞留しているか即時に分かる
2. **着手判断の高速化**：次にやるべき仕事を迷わず選べる
3. **WIP制御**：着手し過ぎを抑止し、完了へ流す
4. **停滞の発見**：止まっている仕事を“理由付き”で顕在化する
5. **会話の場（朝会/レビュー）で即更新**：その場で動かし、追加できる

---

## 2. 画面・モード

### 2.1 通常モード（ボード）

* 列（カラム）× スイムレーン（任意）でカードを表示
* DnDで列移動（=ステータス更新等）
* 列ヘッダ（およびセル）から新規タスク作成
* WIP超過・停滞・期限切れ・未割当・Blocked を視覚強調
* フィルタで対象を絞り、朝会の進行を支援

### 2.2 設定モード（管理者/PM向け）

* 列定義、WIP、スイムレーン、表示項目、停滞閾値等を設定
* ※最初はプラグイン設定画面で良い（SPA内設定画面は後続でも可）

---

## 3. 列（カラム）仕様

### 3.1 列の基準（モード）

* **標準モード（推奨）：ステータス=列**

  * 列の値は `status_id`
  * 既存Redmine運用・ワークフローと整合

* **拡張モード：カスタムフィールド=列**

  * 列の値は `CF(list)` の値
  * ステータスは維持しつつ、作業段階を別管理したい場合

※ 初期リリースは標準モードを必須、拡張モードは設定で有効化。

### 3.2 列設定項目

* 表示順
* 非表示列（例：Closed）
* 列名（表示ラベル）
* WIP制限（後述）
* 列ごとの説明（任意）

---

## 4. スイムレーン仕様（運用強化の中核）

### 4.1 レーン種別

* なし
* **担当者（Assignee）**（推奨デフォルト）
* バージョン（Fixed version）
* 親タスク（Parent issue）※運用によっては重いので任意

### 4.2 レーン表示ルール（担当者レーン）

* レーン一覧は「表示対象チケットに登場する担当者」＋「未割当」
* レーン順は設定可能（任意）

---

## 5. カード仕様

### 5.1 表示項目（デフォルト）

* 件名（subject）
* 担当者（未割当は明示）
* 期日（due_date）
* 優先度（priority）※任意だが推奨
* Blocked状態（後述）
* 停滞日数（後述）

### 5.2 クリック動作

* カードクリック：インライン詳細（軽量パネル）を表示（任意）
* 「詳細を開く」：標準チケット詳細を新規タブで開く（推奨）
* 盤面の文脈を失わないことを優先

---

## 6. 移動（DnD）仕様

### 6.1 基本

* カードを列間移動可能
* 移動確定でサーバ更新（即時反映）

### 6.2 権限・ワークフロー

* 編集権限がない場合、DnDを無効化
* ステータス=列の場合：

  * **ワークフローで許可された遷移のみ成功**
  * 不許可：ロールバック＋理由表示

### 6.3 失敗時挙動（必須）

* 必ず元の位置に戻す（ロールバック）
* 失敗理由を提示（例：遷移不可、権限不足、WIP超過、バリデーション）

---

## 7. WIP制御（必須・運用強化）

### 7.1 WIP制限の単位

設定で選択：

* 列単位（デフォルト）
* 列×レーン単位（担当者別にDoing上限など）

### 7.2 WIP超過時の扱い（設定で選択）

* **禁止（推奨）**：超過する移動は不可、ロールバック
* 警告のみ：移動は可能だが列ヘッダに警告表示

### 7.3 表示

* 列ヘッダに「件数 / 上限」を表示
* 超過時は視覚的に強調

---

## 8. 停滞（Aging）検出・強調（運用強化の要）

### 8.1 停滞の定義

* `updated_on` からの経過日数を停滞日数とする（基本）
* 例：

  * 3日以上更新なし → 注意
  * 7日以上 → 危険
    （閾値は設定可能）

### 8.2 表示ルール

* カードに停滞日数バッジ（例：`5d`）
* 閾値超過でカードを強調

### 8.3 除外条件（任意）

* Done/Closed 列は停滞強調の対象外（デフォルト）
* Blocked は別強調を優先（後述）

---

## 9. Blocked（詰まり理由の可視化）

### 9.1 データ表現

以下いずれか（設定で選択）：

* カスタムフィールド `Blocked (bool)` と `Block reason (text)`
* または 「特定タグ/カテゴリ」運用（簡易）

### 9.2 表示

* Blocked のカードは明確に強調
* 可能なら理由の短文をカードに表示（省略可）

### 9.3 フィルタ

* 「Blockedのみ」を1クリックで表示可能

---

## 10. フィルタ（朝会で使える最小＋運用強化）

必須：

* 担当者（自分／未割当／全員／指定）
* 検索（件名）
* 期限（期限切れ／今週／未設定）
* Blockedのみ

推奨（任意）：

* 優先度
* トラッカー
* バージョン

---

## 11. タスク追加（この画面から可能：必須）

### 11.1 追加トリガー（2段階）

* **列ヘッダの「＋」**（必須）
* レーン×列セルの「＋」（スイムレーン有効時：推奨）

### 11.2 追加位置による初期値決定

* プロジェクト：現在のプロジェクト
* 列：その列の値を自動設定

  * ステータス列 → `status_id`
  * CF列 → CF値
* レーン：

  * 担当者レーン → `assigned_to_id`
  * バージョンレーン → `fixed_version_id`
* 親タスクレーンの場合 → `parent_id`

### 11.3 作成フォーム（最小必須）

* 件名（必須）
* 担当者（任意）
* 期日（任意）
* 優先度（任意）
* Blocked（任意）
* 説明（任意・折りたたみ）

### 11.4 作成結果

* 成功：カードが即座に該当位置へ追加
* 失敗：項目単位のエラー表示（Redmine標準バリデーション準拠）

---

## 12. 一括編集（任意だが運用強化に有効）

### 12.1 目的

朝会で「まとめて担当変更」「期限一括修正」などを高速化する。

### 12.2 操作

* 画面に編集ボタン1つ
* 押下で「表示中カード一覧」ダイアログ
* 保存で一括反映（部分失敗は行単位エラー）

### 12.3 編集可能項目

* 件名、担当者、ステータス、進捗率、期日、カスタムフィールド（設定で制御）

---

## 13. 受入基準（運用観点）

* ボトルネックが分かる：WIP超過が即時に見える/抑止できる
* 停滞が分かる：更新日基準で停滞強調される
* 詰まりが分かる：Blockedが理由とともに見える
* 朝会で動かせる：DnDが安全に動作し、失敗は必ず戻る
* その場で増やせる：列（＋）から作成でき、列/レーン初期値が自動設定される

---

## 14. 設計上の意図（要点）

* かんばんの価値は「可視化」ではなく **流れの制御**（WIP/停滞/Blocked）にある
* 追加は「Backlog投入」だけでなく、**Doing投入の慎重さ**（WIP制限とセット）で価値が出る
